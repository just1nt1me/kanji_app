{% extends "level-test/base.html" %}
{% block content %}

<h1>Kanji Test</h1>
<p>Current Kanji: {{ kanji }}</p>

<form method="post" id="kanjiTestForm">
    {% csrf_token %}
    <input type="text" name="answer" placeholder="Enter the meaning">
    <input type="submit" value="Submit">
</form>

<p id="feedback"></p>

<script>
    // Adding an event listener to the form's submit event
    document.getElementById('kanjiTestForm').addEventListener('submit', function(e) {
        e.preventDefault();  // Preventing the form's default submit action

        let form = e.target;
        let formData = new FormData(form);

        fetch("{% url 'kanji_question' %}", {
            method: 'POST',
            body: formData,
            headers: {
                "X-Requested-With": "XMLHttpRequest"
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .then(data => {
            // If the answer is correct, notify the user and update the UI accordingly
            if (data.is_correct) {
                document.getElementById('feedback').textContent = "Correct! Enter for next kanji.";
                form.querySelector('input[name="answer"]').value = "";  // Clearing the input field
                form.querySelector('input[name="answer"]').classList.add('correct');
                form.querySelector('input[name="answer"]').classList.remove('incorrect');
            } else {
                document.getElementById('feedback').textContent = `Incorrect. The correct answer is: ${data.correct_answer}`;
                form.querySelector('input[name="answer"]').classList.add('incorrect');
                form.querySelector('input[name="answer"]').classList.remove('correct');
            }
        })
        .catch(error => {
            console.error('There was a problem with the fetch operation:', error.message);
        });
    });

    // You can also add other event listeners here, for example, to handle pressing the Enter key for the next question

</script>

{% endblock %}
