{% extends "level-test/base.html" %}
{% block content %}

<h1>Kanji Test</h1>
<h2>Level: {{ level | upper }}</h2>
<p id="currentKanji">Current Kanji: {{ kanji }}</p>

<form method="post" id="kanjiTestForm">
    {% csrf_token %}
    <input type="text" name="answer" placeholder="Enter the meaning">
    <p id="scoreDisplay">Score: 0</p>
</form>

<p id="feedback"></p>

<script>
  const form = document.getElementById('kanjiTestForm');
  const feedbackElem = document.getElementById('feedback');
  const answerInput = form.querySelector('input[name="answer"]');

  form.addEventListener('submit', function(e) {
      e.preventDefault();  // Preventing the form's default submit action

      let formData = new FormData(form);

      fetch("{% url 'kanji_test' %}", {
          method: 'POST',
          body: formData,
          headers: {
              "X-Requested-With": "XMLHttpRequest"
          }
      })
      .then(response => {
          if (!response.ok) {
              throw new Error('Network response was not ok');
          }
          return response.json();
      })
      .then(data => {
          console.log(data);
          if (data.is_correct) {
              feedbackElem.textContent = "Correct!";
              answerInput.value = "";  // Clearing the input field
              answerInput.classList.add('correct');
              answerInput.classList.remove('incorrect');
          } else {
              feedbackElem.textContent = `Incorrect. The correct answer is: ${data.correct_answer}`;
              answerInput.value = "";  // Clearing the input field
              answerInput.classList.add('incorrect');
              answerInput.classList.remove('correct');
          }
          document.getElementById('scoreDisplay').textContent = `Score: ${data.score}`;
          document.getElementById('currentKanji').textContent = `Current Kanji: ${data.kanji}`;
      })
      .catch(error => {
          console.error('There was a problem with the fetch operation:', error.message);
      });
  });
</script>

{% endblock %}
